## Mem config

版本 v6.12

内存模块相关内核配置项速查表

### Kconfig

只列举需要重点关注 并且可能需要定制化配置的

| config                            | owner      | 默认值    | 重点关注 | 配置建议                                                                                                                                                                                                                                                                                                                                          |
| --------------------------------- | ---------- | ------ | ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CONFIG_NUMA                       | kernel     | y      | 是    | 根据实际情况选择是否开启，关闭会降低一点内存分配复杂性                                                                                                                                                                                                                                                                                                                   |
| DEFERRED_STRUCT_PAGE_INIT         | mem page   | n      | 是    | 推迟`page`初始化到系统支持`kthreads`启动后，通过多线程再大内存场景下优化启动时间                                                                                                                                                                                                                                                                                              |
| MEMORY_HOTPLUG                    | hotplug    | y      | 是    | 按需，不需要的话关闭即可                                                                                                                                                                                                                                                                                                                                  |
| CONFIG_ZONE_DEVICE                | hotplug    | n      | 否    | 按需，不需要的话关闭即可                                                                                                                                                                                                                                                                                                                                  |
| CONFIG_HUGETLB_PAGE_SIZE_VARIABLE | mem        | n      | 否    | 当平台上有多个 HugeTLB 页面大小可用时，允许 pageblock_order 值为动态的，而不仅仅是标准的 HUGETLB_PAGE_ORDER。                                                                                                                                                                                                                                                                 |
| CONFIG_HUGETLB_PAGE               | hugetlb    | y      | 是    | 大页内存页                                                                                                                                                                                                                                                                                                                                         |
| LRU_GEN                           | LRU        | n      | 是    | 多级LRU 回收 性能有帮助 待验证                                                                                                                                                                                                                                                                                                                            |
| CONFIG_TRANSPARENT_HUGEPAGE       | 透明大页       | y      | 是    | 透明大页内存，待验证                                                                                                                                                                                                                                                                                                                                    |
| HUGETLB_PAGE                      | 大页内存       | y      | 是    | 大页内存 待验证                                                                                                                                                                                                                                                                                                                                      |
| CONFIG_COMPACTION                 | 内存压缩       | y      | 是    | 支持内存压缩待验证                                                                                                                                                                                                                                                                                                                                     |
| CONFIG_DMA_CMA                    | DMA CMA    | y      | 否    | DMA支持连续物理内存分配                                                                                                                                                                                                                                                                                                                                 |
| CRASH_RESERVE                     | crash      | y      | 否    | 内核crash之后的预留内存                                                                                                                                                                                                                                                                                                                                |
| CONFIG_MEMORY_ISOLATION           |            |        |      |                                                                                                                                                                                                                                                                                                                                               |
| SWIOTLB                           |            |        |      |                                                                                                                                                                                                                                                                                                                                               |
| DEBUG_KMEMLEAK                    | kmemleak   | n      | 否    | debuig开启定位内存泄漏                                                                                                                                                                                                                                                                                                                                |
| DEBUG_KMEMLEAK_MEM_POOL_SIZE      | kmemleak   | 160000 | 否    | 内存泄漏检测的数组长度                                                                                                                                                                                                                                                                                                                                   |
| DEBUG_KMEMLEAK_DEFAULT_OFF        | kmemleak   | n      | 否    | 在开启kmemleak编译后 默认系统启动处于关闭 需要手动`bootconifg` 开启                                                                                                                                                                                                                                                                                                 |
| COMPACTION                        | COMPACTION | y      | 否    | 内存压缩                                                                                                                                                                                                                                                                                                                                          |
| CMA                               |            |        |      |                                                                                                                                                                                                                                                                                                                                               |
| MEMORY_ISOLATION                  |            |        |      |                                                                                                                                                                                                                                                                                                                                               |
| MEMORY_FAILURE                    | recovery   | y      | 是    | 只要体系架构支持 最好默认开启 有助于系统健壮性 可以处理某些内存错误的情况 利用MCA 和  ECC机制                                                                                                                                                                                                                                                                                         |
| CMA                               | CMA        | Y      | 是    | 连续内存申请                                                                                                                                                                                                                                                                                                                                        |
| CONFIG_CONTIG_ALLOC               | CMA        | n      | 否    |                                                                                                                                                                                                                                                                                                                                               |
|                                   |            | y      | 是    | 是否支持连续内存分配                                                                                                                                                                                                                                                                                                                                    |
| PAGE_OWNER                        | Debug      | n      | 否    | 记录page 的owner                                                                                                                                                                                                                                                                                                                                 |
| MEM_ALLOC_PROFILING               | Debug      | n      | 否    | 用于检测内存性能和泄漏                                                                                                                                                                                                                                                                                                                                   |
| PAGE_POISONING                    | Debug      | n      | 是    | 释放内存后设置中毒标志 在申请时检查，用于内存泄漏检查                                                                                                                                                                                                                                                                                                                   |
| CONFIG_DEBUG_PAGEALLOC            | Debug      | n      | 否    |                                                                                                                                                                                                                                                                                                                                               |
| INIT_ON_FREE_DEFAULT_ON           | Sec        | n      | 是    | 这具有在内核命令行上设置“init_on_free=1”的效果。可以使用“init_on_free=0”禁用此功能。<br/>与“init_on_alloc”类似，启用“init_on_free”后，所有页面分配器和 slab 分配器内存在释放时都将清零，从而消除多种“未初始化堆内存”缺陷，尤其是堆内容暴露。与“init_on_free”的主要区别在于，内存中的数据生存期缩短，因为释放的任何内容都会立即被擦除，这使得实时取证或冷启动内存攻击无法恢复释放的内存内容。<br/>性能影响因工作负载而异，但由于接触“冷”内存区域会产生负面缓存效应，因此比“init_on_alloc”更昂贵。大多数情况下影响为 3-5%。<br/>一些合成工作负载测量结果高达 8%。 |
| SHUFFLE_PAGE_ALLOCATOR            |            | y      | 是    | page_allocator 申请 随机化 性能待验证                                                                                                                                                                                                                                                                                                                   |
| CONFIG_SLUB_TINY                  | SLUB       | n      | 是    | 嵌入式场景 尤其是内存在<16MB的场景下 开启此选项                                                                                                                                                                                                                                                                                                                   |

### boot config

### memblock

#### Kconfig

- HAVE_MEMBLOCK_PHYS_MAP : 体系架构负责选择开启，目前大部分关闭

- 

#### bootconfig
